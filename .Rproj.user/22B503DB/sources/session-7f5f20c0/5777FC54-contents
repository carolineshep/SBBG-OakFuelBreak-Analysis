---
title: "Assignment2: Crop Yield Function"
author: "Caroline Shepherd and Trevor Maggart"
date: "4/20/2023"
output:
  html_document:
    theme: cerulean
    code_folding: hide
    highlight: monochrome
    toc: yes
    toc_depth: 5
    toc_float: yes
    collapsed: yes
    smooth_scroll: yes
    number_sections: no
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, messages = FALSE)

# read in packages
library(tidyverse)
library(here)

```

## Making a function to predict almond yield


### Conceptual model:

```{r, include=TRUE, }
# insert model diagram

knitr::include_graphics("concept_model.jpeg")

```

```{r, include=TRUE}
# working area - creating code needed for function
# read in climate text file
climate <- read.table(here("data", "clim.txt"), header=T)

climate_test <- climate %>% 
    group_by(year,month) %>% 
    summarize(tmin = min(tmin_c),
              tmax = max(tmax_c),
              precip_sum = sum(precip))

Tn2 <- (climate_test %>% filter(month==2))$tmin
P1 <- (climate_test %>% filter(month==1))$precip_sum

Y = (-0.015)*Tn2 - (0.0046)*(Tn2**2) - (0.07*P1) + (0.0043)*(P1**2) + 0.28

```

### Almond crop yield function:
```{r, include=TRUE, class.source = "fold-show"}
#' Crop Yield Anomaly Function
#' 
#' Compute a crop yield anomaly for almonds
#' @param climate_data dataframe of climate data (include columns: year, month, day, tmin_c, tmax_c, precip)
#' @param tmin1_coeff minimum temperature coefficient
#' @param tmin2_coeff minimum squared temperature coefficient
#' @param precip1_coeff precipitation sum coefficient
#' @param precip2_coeff precipitation sum squared coefficient
#' @param intercept y-intercept
#' @return list of mean, max, and min monthly yield
#' @examples
#' month_yld_almond(climate)
#' Tn2 = (Minimum temperature) in February (Degrees C)
#' P1 = (Sum of precipitation) in January (mm)

yld_almond <- function(climate_data, tmin1_coeff = -0.015, tmin2_coeff = 0.0046, precip1_coeff = 0.07, precip2_coeff = 0.0043, intercept = 0.28){
  
  climate_data <- climate_data %>% 
    # group by year and month
    group_by(year,month) %>%
    #find the min temp, max temp, and sum of precipitation (each monthly)
    summarize(tmin_mean = mean(tmin_c),
              tmax_mean = mean(tmax_c),
              precip_sum = sum(precip))
 
  # create variables for minimum temperature and precipitation sum
  Tn2 <- (climate_data %>% filter(month == 2))$tmin_mean
  P1 <- (climate_data %>% filter(month == 1))$precip_sum
  
  # equation for monthly almond yield
  Y = (tmin1_coeff)*Tn2 - (tmin2_coeff)*(Tn2**2) - (precip1_coeff*P1) + (precip2_coeff)*(P1**2) + intercept
  
  # define function output to return min, max, and mean almond crop yield
  return(list(min(Y), max(Y), mean(Y)))
    
}
  
# testing function
yld_almond(climate)

```

